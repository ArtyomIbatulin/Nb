// https://www.prisma.io/docs/getting-started/setup-prisma/start-from-scratch/mongodb-typescript-mongodb

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// https://www.prisma.io/docs/orm/overview/databases/mongodb

model User {
  id Int @id @default(autoincrement())

  email     String @unique
  password  String
  name      String
  avatarUrl String
  role      Role   @default(USER)

  cart     Cart? // one to one 
  wishlist Wishlist? // one to one 
  orders   Order[] // one to many

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Book {
  id Int @id @default(autoincrement())

  name        String
  imgUrl      String
  price       String
  description String

  category   Category @relation(fields: [categoryId], references: [id]) // one to many
  categoryId Int

  // author    User?   @relation(fields: [authorId], references: [id])
  // authorId  Int

  authors Author[] //many to many

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Author {
  id Int @id @default(autoincrement())

  name String @unique

  books Book[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cart {
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique // one to one 

  items CartItem[]

  totalAmount Int    @default(0)
  token       String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CartItem {
  id Int @id @default(autoincrement())

  // book or bookItem ??? 

  cart   Cart @relation(fields: [cartId], references: [id])
  cartId Int

  quantity Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Wishlist {
  // id String @id @default(auto()) @map("_id") @db.ObjectId
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique // one to one 

  items WishlistItem[]

  //  token      String ???

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WishlistItem {
  id Int @id @default(autoincrement())

  // book or bookItem ??? 

  wishlist   Wishlist @relation(fields: [wishlistId], references: [id])
  wishlistId Int

  quantity Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id])
  userId Int  @unique

  token      String
  totalAmout Int
  status     Status
  paymentId  String?

  items Json // список товаров в заказе 

  name    String
  email   String
  phone   String
  address String
  comment String? // инфа о заказчике со страницы оформления заказа 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id Int @id @default(autoincrement())

  name  String @unique
  books Book[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Comment {
  id Int @id @default(autoincrement())

  text String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Rating {
  id Int @id @default(autoincrement())

  rating String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  USER
  ADMIN
}

enum Status {
  PENDING
  SUCCEEDED
  CANCELLED
}

// https://github.com/prisma/prisma/issues/7119
