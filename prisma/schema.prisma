generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id Int @id @default(autoincrement())

  email     String @unique
  password  String
  name      String
  avatarUrl String
  role      Role   @default(USER)

  cart     Cart? // one to one 
  wishlist Wishlist? // one to one 
  orders   Order[] // one to many
  comments Comment[] // one to many
  ratings  Rating[] // one to many

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Book {
  id Int @id @default(autoincrement())

  name        String
  imgUrl      String
  price       String
  description String

  category   Category @relation(fields: [categoryId], references: [id]) // one to many
  categoryId Int

  comments Comment[] // one to many

  rating   Rating @relation(fields: [ratingId], references: [id]) // one to many
  ratingId Int

  authors Author[] //many to many

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Author {
  id Int @id @default(autoincrement())

  name String @unique

  books Book[] // many to many

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cart {
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id]) // one to one
  userId Int  @unique

  items CartItem[]

  totalAmount Int    @default(0)
  token       String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CartItem {
  id Int @id @default(autoincrement())

  // book or bookItem ??? 

  cart   Cart @relation(fields: [cartId], references: [id]) // one to many
  cartId Int

  quantity Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Wishlist {
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id]) // one to one
  userId Int  @unique

  items WishlistItem[]

  //  token      String ???

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WishlistItem {
  id Int @id @default(autoincrement())

  // book or bookItem ??? 

  wishlist   Wishlist @relation(fields: [wishlistId], references: [id])
  wishlistId Int

  quantity Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id Int @id @default(autoincrement())

  user   User @relation(fields: [userId], references: [id]) // one to many
  userId Int

  token      String
  totalAmout Int
  status     Status
  paymentId  String?

  items Json // список товаров в заказе 

  name    String
  email   String
  phone   String
  address String
  comment String? // инфа о заказчике со страницы оформления заказа 

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Category {
  id Int @id @default(autoincrement())

  name  String @unique
  books Book[] // one to many

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Comment {
  id Int @id @default(autoincrement())

  text String

  book   Book @relation(fields: [bookId], references: [id]) // one to many
  bookId Int

  user   User @relation(fields: [userId], references: [id]) // one to many
  userId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Rating {
  id Int @id @default(autoincrement())

  rating String

  books Book[] // one to many

  user   User @relation(fields: [userId], references: [id]) // one to many
  userId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum Role {
  USER
  ADMIN
}

enum Status {
  PENDING
  SUCCEEDED
  CANCELLED
}
